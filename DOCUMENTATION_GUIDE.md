# Руководство по документированию кода

## Принципы документирования

**Цель:** Любой разработчик (включая вас через год) должен понять:
- Что делает файл
- Зачем он нужен
- Как его использовать
- Где находятся зависимости

---

## Структура комментариев файла

### Обязательный заголовок каждого файла

```typescript
/**
 * Название файла и его назначение
 *
 * Описание:
 * - Что делает этот файл
 * - Для чего он используется
 * - Ключевые функции/компоненты
 *
 * Зависимости:
 * - Что импортирует
 * - С чем интегрируется
 *
 * Используется в:
 * - Где этот файл используется
 *
 * @module путь/к/файлу
 * @created DD.MM.YYYY
 * @author Имя
 */
```

### Пример для React компонента

```typescript
/**
 * Страница управления пользователями
 *
 * Описание:
 * - Отображает таблицу всех пользователей системы
 * - Позволяет создавать, редактировать, удалять пользователей
 * - Поддерживает пагинацию, поиск и фильтрацию
 * - Доступна только администраторам и модераторам
 *
 * Зависимости:
 * - usersApi - для работы с API пользователей
 * - UserFormModal - модальное окно редактирования
 * - UserViewModal - модальное окно просмотра
 *
 * Используется в:
 * - MainLayout (роут /users)
 *
 * @module pages/UsersPage
 */
```

### Пример для API файла

```typescript
/**
 * API клиент для работы с пользователями
 *
 * Описание:
 * - Предоставляет методы для CRUD операций с пользователями
 * - Обрабатывает пагинацию и фильтрацию
 * - Загрузка/удаление аватаров
 * - Управление организациями
 *
 * Эндпоинты:
 * - GET /users - список пользователей (с пагинацией)
 * - GET /users/:id - получить пользователя
 * - POST /users - создать пользователя
 * - PUT /users/:id - обновить пользователя
 * - DELETE /users/:id - удалить пользователя
 * - POST /users/:id/avatar - загрузить аватар
 *
 * @module shared/api/users.api
 */
```

### Пример для утилиты

```typescript
/**
 * Утилиты для форматирования и валидации телефонных номеров
 *
 * Описание:
 * - Форматирование номеров в красивый вид (+7 (777) 123-45-67)
 * - Валидация российских и международных номеров
 * - Очистка номеров от лишних символов
 *
 * Поддерживаемые форматы:
 * - Российские: +7, 8, 7 (11 цифр)
 * - Международные: 10-15 цифр
 *
 * Используется в:
 * - UserFormModal - валидация телефонов
 * - SocialLinksInput - валидация WhatsApp
 *
 * @module shared/utils/formatPhone
 */
```

---

## JSDoc для функций

### Простая функция

```typescript
/**
 * Форматирует телефонный номер в красивый вид
 *
 * @param value - Исходный номер (может содержать любые символы)
 * @returns Отформатированный номер
 *
 * @example
 * formatPhoneNumber("79991234567")  // "+7 (999) 123-45-67"
 * formatPhoneNumber("89991234567")  // "8 (999) 123-45-67"
 */
export const formatPhoneNumber = (value: string): string => {
  // ...
}
```

### React компонент

```typescript
/**
 * Модальное окно для просмотра информации о пользователе
 *
 * Описание:
 * - Отображает полную информацию о пользователе
 * - Кнопки "Редактировать" и "Удалить" (в зависимости от прав)
 * - Проверка прав доступа (админ/модератор/сам пользователь)
 *
 * @param props - Свойства компонента
 * @param props.isOpen - Открыто ли модальное окно
 * @param props.user - Данные пользователя для отображения
 * @param props.onClose - Callback при закрытии
 * @param props.onEdit - Callback при нажатии "Редактировать"
 * @param props.onDelete - Callback при нажатии "Удалить"
 *
 * @example
 * <UserViewModal
 *   isOpen={isOpen}
 *   user={selectedUser}
 *   onClose={() => setIsOpen(false)}
 *   onEdit={() => handleEdit()}
 *   onDelete={() => handleDelete()}
 * />
 */
export function UserViewModal({ isOpen, user, onClose, onEdit, onDelete }: UserViewModalProps) {
  // ...
}
```

### API функция

```typescript
/**
 * Создает нового пользователя в системе
 *
 * Описание:
 * - Отправляет POST запрос на /users
 * - Валидирует данные перед отправкой
 * - Возвращает созданного пользователя с ID
 *
 * Права доступа: Только администраторы
 *
 * @param userData - Данные нового пользователя
 * @returns Объект с созданным пользователем
 * @throws {Error} Если пользователь с таким username уже существует
 * @throws {Error} Если email невалидный
 *
 * @example
 * const result = await usersApi.create({
 *   full_name: "Иван Иванов",
 *   username: "ivanov",
 *   password: "SecurePass123!",
 *   email: "ivanov@example.com",
 *   role: "user"
 * });
 */
async create(userData: CreateUserRequest): Promise<{ user: User }> {
  // ...
}
```

---

## Комментарии внутри кода

### Хорошие комментарии

```typescript
// ✅ ХОРОШО - объясняет ПОЧЕМУ, а не ЧТО
// Проверяем права доступа: модератор может редактировать только обычных пользователей
const canEdit = isAdmin || (isModerator && user.role === "user");

// ✅ ХОРОШО - объясняет неочевидную логику
// Российские номера начинаются с +7, 7 или 8, и содержат ровно 11 цифр
if (cleaned.startsWith("+7")) {
  return cleaned.length === 12; // +7 и 10 цифр
}

// ✅ ХОРОШО - предупреждает о важных деталях
// ВАЖНО: Не используем import React в React 17+
// JSX транспилируется автоматически

// ✅ ХОРОШО - объясняет временное решение
// TODO: Заменить на WebSocket когда бэкенд будет готов
const pollInterval = 5000;
```

### Плохие комментарии

```typescript
// ❌ ПЛОХО - очевидно из кода
// Увеличиваем counter на 1
counter++;

// ❌ ПЛОХО - дублирует код
// Устанавливаем loading в true
setLoading(true);

// ❌ ПЛОХО - устаревший комментарий
// Используем старый API endpoint (уже давно не используется)
await newApi.fetch();

// ❌ ПЛОХО - закомментированный код без объяснения
// const oldFunction = () => {
//   return something;
// }
```

---

## Секции кода

Для больших файлов используйте секции:

```typescript
/* ========================================
   ТИПЫ И ИНТЕРФЕЙСЫ
   ======================================== */

export interface User {
  id: number;
  // ...
}

/* ========================================
   КОНСТАНТЫ
   ======================================== */

const MAX_FILE_SIZE = 5 * 1024 * 1024; // 5 MB

/* ========================================
   ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ
   ======================================== */

function validateEmail(email: string): boolean {
  // ...
}

/* ========================================
   ОСНОВНОЙ КОМПОНЕНТ
   ======================================== */

export function MyComponent() {
  // ...
}
```

---

## Специальные маркеры

```typescript
// TODO: Описание что нужно сделать
// FIXME: Описание что нужно исправить
// HACK: Описание временного решения
// NOTE: Важное примечание
// WARNING: Предупреждение о потенциальных проблемах
// DEPRECATED: Устаревший код, не использовать
```

---

## Документирование архитектуры

### Структура папок

Создать `ARCHITECTURE.md` с описанием:

```markdown
# Архитектура проекта

## Frontend

### Структура папок
- `src/app` - Корневые компоненты приложения (App, Router, Layout)
- `src/pages` - Страницы приложения (каждая страница = роут)
- `src/features` - Фичи/модули (auth, user, reports)
- `src/shared` - Переиспользуемый код
  - `api/` - API клиенты и хуки
  - `ui/` - UI компоненты (Button, Modal, Card)
  - `utils/` - Утилиты (logger, formatPhone, validation)
  - `hooks/` - Кастомные React хуки
  - `types/` - TypeScript типы

### Паттерны
- **Feature-based** - код группируется по фичам, не по типам файлов
- **Atomic Design** - UI компоненты от простых к сложным
- **API Layer** - вся работа с API через отдельный слой
```

---

## Чеклист перед коммитом

- [ ] Каждый файл имеет заголовок с описанием
- [ ] Все экспортируемые функции имеют JSDoc
- [ ] Сложная логика прокомментирована
- [ ] Нет закомментированного кода (или есть объяснение почему)
- [ ] Комментарии на русском языке
- [ ] Примеры использования для API и компонентов

---

## Примеры файлов с хорошей документацией

Эталонные файлы проекта:
- ✅ `frontend/src/shared/utils/logger.ts` - отличная документация утилиты
- ✅ `frontend/src/shared/api/hooks/useUsers.ts` - примеры JSDoc для хуков
- ✅ `LOGGER_GUIDE.md` - подробное руководство пользователя

Следуйте этому стилю!
