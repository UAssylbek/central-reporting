# Инструкция по улучшению комментариев в проекте

## ✅ Что уже сделано

1. **Создана документация:**
   - [DOCUMENTATION_GUIDE.md](DOCUMENTATION_GUIDE.md) - руководство по документированию
   - [ADD_FILE_HEADERS.md](ADD_FILE_HEADERS.md) - готовые заголовки для файлов
   - Этот файл - инструкция по применению

2. **Добавлены заголовки:**
   - ✅ `frontend/src/shared/api/users.api.ts` - полная документация API

---

## 📋 План дальнейших действий

### Этап 1: Добавить заголовки к основным файлам (15-20 мин)

Откройте [ADD_FILE_HEADERS.md](ADD_FILE_HEADERS.md) и скопируйте готовые заголовки в начало следующих файлов:

#### Frontend - Pages
- [ ] `frontend/src/pages/UsersPage/UsersPage.tsx`
- [ ] `frontend/src/pages/HomePage/HomePage.tsx`
- [ ] `frontend/src/pages/LoginPage/LoginPage.tsx`
- [ ] `frontend/src/pages/ProfilePage/ProfilePage.tsx`

#### Frontend - API
- [ ] `frontend/src/shared/api/auth.api.ts`
- [ ] `frontend/src/shared/api/client.ts`

#### Frontend - Utils
- [x] `frontend/src/shared/utils/logger.ts` - УЖЕ ЕСТЬ отличная документация!
- [ ] `frontend/src/shared/utils/formatPhone.ts`
- [ ] `frontend/src/shared/utils/validateSocialLinks.ts`

#### Frontend - UI
- [ ] `frontend/src/shared/ui/Button/Button.tsx`
- [ ] `frontend/src/shared/ui/Modal/Modal.tsx`
- [ ] `frontend/src/shared/ui/Card/Card.tsx`

#### Backend
- [ ] `backend/cmd/main.go`
- [ ] `backend/internal/handlers/users.go`
- [ ] `backend/internal/handlers/auth.go`

---

### Этап 2: Перевести английские комментарии (10-15 мин)

Найдите и переведите все английские комментарии на русский.

#### Примеры для замены:

**UserFormModal.tsx:**
```typescript
// БЫЛО (английский):
// Moderator edits user - only organizations
if (isModeratorEditingOthers && user) {

// СТАЛО (русский):
// Модератор редактирует пользователя - только организации
if (isModeratorEditingOthers && user) {
```

**UsersPage.tsx:**
```typescript
// БЫЛО:
// Checkbox only for admin

// СТАЛО:
// Чекбокс только для админа
```

#### Как найти английские комментарии:

В VSCode используйте поиск (Ctrl+Shift+F):
- Ищите `// [A-Z]` (регулярное выражение)
- Смотрите на комментарии начинающиеся с заглавной английской буквы
- Переводите на русский

---

### Этап 3: Добавить JSDoc к сложным функциям (20-30 мин)

#### Что требует JSDoc:

1. **Все экспортируемые функции**
2. **Сложные функции с бизнес-логикой**
3. **API методы**
4. **React компоненты**

#### Шаблон JSDoc:

```typescript
/**
 * Краткое описание что делает функция
 *
 * Подробное описание (опционально):
 * - Что происходит внутри
 * - Какие есть особенности
 * - На что обратить внимание
 *
 * @param paramName - Описание параметра
 * @returns Описание возвращаемого значения
 * @throws {ErrorType} Когда выбрасывается ошибка
 *
 * @example
 * // Пример использования
 * const result = myFunction(param);
 */
```

#### Примеры файлов с хорошим JSDoc:

✅ **Эталонные примеры:**
- `frontend/src/shared/utils/logger.ts` - отличный JSDoc
- `frontend/src/shared/api/hooks/useUsers.ts` - примеры для хуков
- `frontend/src/shared/utils/formatPhone.ts` - нужно добавить JSDoc

#### Приоритетные функции для документирования:

**formatPhone.ts:**
```typescript
/**
 * Форматирует телефонный номер в красивый вид
 *
 * Поддерживаемые форматы ввода:
 * - "79991234567" → "+7 (999) 123-45-67"
 * - "89991234567" → "8 (999) 123-45-67"
 * - "+79991234567" → "+7 (999) 123-45-67"
 *
 * @param value - Исходный номер (может содержать любые символы)
 * @returns Отформатированный номер в виде +7 (XXX) XXX-XX-XX
 *
 * @example
 * formatPhoneNumber("79991234567")  // "+7 (999) 123-45-67"
 * formatPhoneNumber("9991234567")   // "999 123-45-67"
 */
export const formatPhoneNumber = (value: string): string => {
```

**validateSocialLinks.ts:**
```typescript
/**
 * Валидирует ссылку на социальную сеть
 *
 * Проверяет корректность формата в зависимости от платформы.
 * Пустые значения считаются валидными (поля опциональные).
 *
 * @param key - Тип социальной сети (telegram, whatsapp, linkedin и т.д.)
 * @param value - Значение ссылки или username
 * @returns true если формат корректный или поле пустое, false если заполнено неправильно
 *
 * @example
 * validateSocialLink("telegram", "https://t.me/username")  // true
 * validateSocialLink("telegram", "@username")              // true
 * validateSocialLink("telegram", "invalid")                // false
 * validateSocialLink("whatsapp", "+79991234567")           // true
 */
export const validateSocialLink = (
```

---

### Этап 4: Документировать архитектуру (30-40 мин)

Создайте файл `ARCHITECTURE.md` с описанием структуры проекта:

```markdown
# Архитектура проекта Central Reporting

## Обзор

Central Reporting - система управления отчетностью с разграничением прав доступа.

### Технологии
- **Frontend**: React 18 + TypeScript + Tailwind CSS v4
- **Backend**: Go 1.21 + Gin + PostgreSQL
- **Аутентификация**: JWT токены
- **State Management**: React Query (TanStack Query)

---

## Frontend Архитектура

### Структура папок

```
frontend/src/
├── app/                    # Корневое приложение
│   ├── layouts/           # Layouts (MainLayout, AuthLayout)
│   ├── providers/         # React providers (Query, Theme)
│   └── router/            # Роутинг приложения
│
├── pages/                  # Страницы приложения
│   ├── HomePage/          # Главная - каталог отчетов
│   ├── UsersPage/         # Управление пользователями
│   ├── LoginPage/         # Вход в систему
│   └── ProfilePage/       # Профиль пользователя
│
├── features/               # Бизнес-фичи
│   ├── auth/              # Аутентификация
│   ├── user/              # Управление пользователями
│   └── reports/           # Отчеты
│
├── shared/                 # Переиспользуемый код
│   ├── api/               # API клиенты
│   │   ├── auth.api.ts   # Аутентификация
│   │   ├── users.api.ts  # Пользователи
│   │   ├── client.ts     # HTTP клиент
│   │   └── hooks/        # React Query хуки
│   │
│   ├── ui/                # UI компоненты
│   │   ├── Button/
│   │   ├── Modal/
│   │   ├── Card/
│   │   └── ...
│   │
│   ├── utils/             # Утилиты
│   │   ├── logger.ts     # Логирование
│   │   ├── formatPhone.ts
│   │   └── validateSocialLinks.ts
│   │
│   ├── hooks/             # Custom hooks
│   ├── types/             # TypeScript типы
│   └── styles/            # Стили и анимации
│
└── index.css              # Глобальные стили
```

### Паттерны

#### Feature-Based Organization
Код группируется по фичам, не по типам файлов:
```
features/user/
├── UserFormModal/        # Модальное окно редактирования
├── UserViewModal/        # Модальное окно просмотра
└── components/           # Компоненты специфичные для фичи
```

#### API Layer
Вся работа с API через отдельный слой:
```typescript
// ✅ ПРАВИЛЬНО
const users = await usersApi.getUsers();

// ❌ НЕПРАВИЛЬНО
const response = await fetch('/api/users');
```

#### React Query для State Management
Вместо useState для серверных данных:
```typescript
// ✅ ПРАВИЛЬНО
const { data: users } = useUsers({ page: 1 });

// ❌ НЕПРАВИЛЬНО
const [users, setUsers] = useState([]);
useEffect(() => { fetch... }, []);
```

---

## Backend Архитектура

### Структура папок

```
backend/
├── cmd/
│   ├── main.go            # Точка входа
│   └── create_admin/      # Утилита создания админа
│
├── internal/
│   ├── handlers/          # HTTP handlers
│   │   ├── auth.go
│   │   ├── users.go
│   │   └── ...
│   │
│   ├── repositories/      # Работа с БД
│   │   ├── user.go
│   │   ├── audit_log.go
│   │   └── ...
│   │
│   ├── models/            # Модели данных
│   │   └── user.go
│   │
│   └── middleware/        # Middleware
│       ├── auth.go        # JWT проверка
│       ├── cors.go        # CORS
│       └── rate_limit.go  # Rate limiting
│
├── migrations/            # Миграции БД
└── .env.example          # Пример конфигурации
```

### Слои приложения

```
HTTP Request
    ↓
Handler (валидация, авторизация)
    ↓
Repository (работа с БД)
    ↓
Database
```

---

## База данных

### Основные таблицы

1. **users** - пользователи системы
2. **audit_log** - логирование действий
3. **organizations** - справочник организаций
4. **password_reset_tokens** - токены восстановления пароля

### Индексы

Все таблицы оптимизированы индексами для быстрого поиска.

---

## Аутентификация и Авторизация

### Роли

- **admin** - полный доступ ко всем функциям
- **moderator** - управление пользователями (ограниченно)
- **user** - базовый доступ

### JWT Токены

- Хранятся в localStorage (фронтенд)
- Отправляются в заголовке Authorization: Bearer <token>
- Проверяются middleware на бэкенде

---

## Документация

- **DOCUMENTATION_GUIDE.md** - стандарты документирования
- **LOGGER_GUIDE.md** - система логирования
- **CURRENT_STATUS.md** - статус проекта
- **README.md** - быстрый старт
```

---

## ✅ Чеклист выполнения

### Обязательное (1-2 часа)
- [ ] Добавить заголовки к 10+ ключевым файлам
- [ ] Перевести английские комментарии на русский
- [ ] Добавить JSDoc к основным функциям (formatPhone, validateSocialLinks)

### Желательное (еще 1 час)
- [ ] Создать ARCHITECTURE.md
- [ ] Добавить примеры использования в JSDoc
- [ ] Документировать сложные функции

### Опционально (по желанию)
- [ ] Добавить диаграммы архитектуры
- [ ] Создать видео-обзор проекта
- [ ] Написать FAQ.md

---

## 🎯 Результат

После выполнения:
1. ✅ Любой разработчик поймет структуру проекта
2. ✅ Вы сами через год легко вспомните что где
3. ✅ Все файлы имеют описание назначения
4. ✅ Сложные функции задокументированы
5. ✅ Комментарии на русском языке

---

## 📚 Дополнительные ресурсы

- [TSDoc Reference](https://tsdoc.org/) - стандарт JSDoc для TypeScript
- [Go Documentation](https://go.dev/blog/godoc) - документирование Go кода
- Примеры в проекте: `logger.ts`, `useUsers.ts`

---

Начните с этапа 1 - это займет всего 15-20 минут, но сильно улучшит понятность проекта!
